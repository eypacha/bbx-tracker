function preload(){for(i=0;i<preload.arguments.length;i++)images[i]=new Image,images[i].src="img/pacha-"+preload.arguments[i]+".png"}var patron,sound,step=0,steps=2,tracker,loop=!0,bpm=80,minBpm=10,maxBpm=300,maxSteps=8,images=new Array,trackUrl;preload("boca-b","boca-pf","boca-ts","boca-c","boca-k","boca-m","boca-b","boca-o","boca-u","boca---","ojos-1","ojos-2"),$(document).ready(function(){function a(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+a+"=([^&#]*)"),s=e.exec(location.search);return null===s?"":decodeURIComponent(s[1])}function t(){$("#shareBtn").addClass("collapse"),$("#waitingBox").removeClass("collapse");var a=LZString.compressToBase64($("#tracker").val());trackUrl="https://eypacha.github.io/bbx-tracker/?beat="+a+"&bpm="+bpm+"&steps="+steps,""==$("#shortlink").val()&&o(trackUrl,function(a){"undefined"==typeof a&&(a=trackUrl),$("#fbShare").attr("href","https://www.facebook.com/sharer/sharer.php?u="+a),$("#twShare").attr("href","https://twitter.com/share?url="+a+"&text=Escucha%20el%20beat%20que%20acabo%20de%20hacer!&hashtags=bbxtracker,beatbox,bbx&via=eypacha"),$("#btEmail").attr("href","mailto:?subject=Escucha el beat que acabo de hacer!&body=Beat hecho con BBX Tracker! > "+a),$("#shortlink").val(a),$("#shareIt").removeClass("collapse"),$("#waitingBox").addClass("collapse")})}function o(a,e){$.getJSON("https://api-ssl.bitly.com/v3/shorten?",{access_token:"4da3dd9ee59dfe487358e3d656aa6e2bcc1000eb",longUrl:a,format:"json"},function(a){console.log(a),e(a.data.url)})}function r(){tracker=$("#tracker").val(),tracker=tracker.replace(/(\r\n|\n|\r)/gm," "),tracker=tracker.split(" ");for(var a=tracker.indexOf("");a>-1;)tracker.splice(a,1),a=tracker.indexOf("");$("#playBtn").addClass("collapse"),$("#stopBtn").removeClass("collapse"),patron=setInterval(function(){p()},3600/bpm*16/steps),$(".tempo button").toggleDisabled(),$("#tracker").toggleDisabled(),$("#shortlink").val(""),$("#shareBtn").removeClass("collapse"),$("#shareIt").addClass("collapse"),$("#waitingBox").addClass("collapse")}function p(){var a=0;switch(step%4){case 1:a=1;break;case 3:a=2;break;case 2:case 0:default:a=0}$("#pacha").css("background-image","url('img/pacha-ojos-"+a+".png')");var e="",s="";switch(tracker[step].toLowerCase()){case"b":case"b-":case"p":case"p-":e="B-",s="b";break;case"ts":case"t":case"t-":e="ts",s="ts";break;case"pf":e="Pf",s="pf";break;case"c1":e="c1",s="c";break;case"c2":case"c":case"c-":e="c2",s="c";break;case"c3":e="c3",s="c";break;case"^k":case"k":case"k-":e="^K",s="k";break;case"m-":case"^m":case"mm":e="^m",s="m";break;case"bb":e="BB",s="bb";break;case"ió":case"io":case"yo":e="ió",s="o";break;case"soy":case"soi":e="soy",s="o";break;case"pa":e="Pa",s="b";break;case"cha!":e="Cha",s="k";break;case"vi":case"bi":case"pi":e="vi",s="k";break;case"buen":e="buen",s="b";break;case"pfar":e="pfar",s="f";break;case"ke":case"que":e="ke",s="k";break;case"cha":e="cha",s="b";break;case"que":e="cha",s="b";break;case"ca":case"ka":e="ca",s="b";break;case"bu":case"pu":e="bu",s="u";break;case"co":case"ko":e="co",s="o";break;default:e="--",s="--"}sound.play(e),$("#pacha div").css("background-image","url('img/pacha-boca-"+s+".png')"),step++,step>=tracker.length&&(loop?step=0:n())}function n(){clearInterval(patron),step=0,ojos=0,$("#pacha div").css("background-image","url('img/pacha-boca---.png')"),$("#pacha").css("background-image","url('img/pacha-ojos-"+ojos+".png')"),$("#playBtn").removeClass("collapse"),$("#stopBtn").addClass("collapse"),$(".tempo button").toggleDisabled(),$("#tracker").toggleDisabled()}function l(){loop?$("#loopBtn").addClass("noloop"):$("#loopBtn").removeClass("noloop"),loop=!loop}function i(a){(0>a&&bpm>minBpm||a>0&&maxBpm>bpm)&&(bpm+=a),minBpm>bpm&&(bpm=minBpm),bpm>maxBpm&&(bpm=maxBpm),$("#bpm").html(bpm+" BPM")}function b(a){(0>a&&steps>1||a>0&&maxSteps>steps)&&(steps+=a),1>steps&&(steps=1),steps>maxSteps&&(steps=maxSteps),$("#steps").html("/ "+steps)}$("#playBtn").on("click",r),$("#stopBtn").on("click",n),$("#loopBtn").on("click",l),$("#tempoUp").on("click",function(){i(1)}),$("#tempoDown").on("click",function(){i(-1)}),$("#tempoUpUp").on("click",function(){i(10)}),$("#tempoDownDown").on("click",function(){i(-10)}),$("#moreSteps").on("click",function(){b(1)}),$("#lessSteps").on("click",function(){b(-1)}),$("#shareBtn").on("click",t),sound=new Howl({src:["audio/sounds.mp3"],rate:1,sprite:{"B-":[48,300],Pf:[430,300],ts:[1084,300],c1:[2429,210],c2:[2666,300],c3:[3373,300],"^K":[2135,250],"^m":[3869,250],BB:[5201,350],"ió":[6055,350],soy:[6513,350],Pa:[6930,330],Cha:[7287,360],vi:[7697,350],buen:[8052,220],pfar:[8316,288],ke:[8651,101],cha:[8805,140],ca:[9024,189],bu:[9221,318],co:[9591,277]}});var e=a("beat");e.length>0&&$("#tracker").html(LZString.decompressFromBase64(e));var s=a("bpm");s.length>0&&s>=minBpm&&maxBpm>=s&&(bpm=parseInt(s),$("#bpm").html(bpm+" BPM"));var c=a("steps");c.length>0&&c>=1&&maxSteps>=c&&(steps=parseInt(c),$("#steps").html("/ "+steps)),$.fn.toggleDisabled=function(){return this.each(function(){var a=$(this);a.attr("disabled")?a.removeAttr("disabled"):a.attr("disabled","disabled")})}});